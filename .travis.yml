language: java
jdk:
- oraclejdk8
sudo: required
services:
- docker
env:
  global:
  - IMAGE=cerios/cerioscoop
  - COMMIT=${TRAVIS_COMMIT::8}
  - IMAGE_VERSION=$IMAGE:travis-$TRAVIS_BUILD_NUMBER
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - CLOUDSDK_INSTALL_DIR=googlestuff
# de CLOUDSDK_CORE_DISABLE_PROMPTS is nodig want anders gaat travis wachten op input en geeft het een timeout
# de CLOUDSDK_INSTALL_DIR is nodig want anders neemt hij default dir google-cloud-sdk en die bestaat al
cache:
  directories:
  - $HOME/$CLOUDSDK_INSTALL_DIR

before_install:
- openssl aes-256-cbc -K $encrypted_418a88f24735_key -iv $encrypted_418a88f24735_iv
  -in client-secret.json.enc -out client-secret.json -d
- chmod +x publish-codacy-coverage.sh
- chmod +x deploy-to-gcloud.sh

script:
- mvn package jacoco:report

after_success:
- ./publish-codacy-coverage.sh
- if [ "$TRAVIS_BRANCH" == "master" ] || [ "$TRAVIS_BRANCH" == "travis" ]; then
    ./deploy-to-gcloud.sh;
  fi

